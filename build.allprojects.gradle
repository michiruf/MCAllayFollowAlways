allprojects {
    // This can get extracted into a root build.gradle if needed
    ext {
        getLatestTag = {
            providers.exec {
                commandLine("git", "describe", "--tags", "--abbrev=0")
            }.standardOutput.asText.get().trim()
        }

        getCurrentCommitCount = {
            providers.exec {
                commandLine("git", "rev-list", "--all", "--count")
            }.standardOutput.asText.get().trim()
        }
    }

    try {
        project.version = "${project.getLatestTag()}.${project.getCurrentCommitCount()}"
    } catch (Exception e) {
        println('Either git is not set up properly, or there is no tag yet in the repository. Falling back to version \'0\'')
        e.printStackTrace()
        project.version = '0'
    }
    project.group = 'michiruf'
}
